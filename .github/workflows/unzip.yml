name: Unzip Quran to Root (101–114)

on:
  push:
    paths:
      - '**/*.zip'

jobs:
  unzip:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract 101–114 folders directly to repository root
        run: |
          find . -name "*.zip" -type f | while read zipfile; do
            echo "Extracting: $zipfile"
            temp_dir=$(mktemp -d)
            unzip -o "$zipfile" -d "$temp_dir"

            # শুধু 101 থেকে 114 ফোল্ডারগুলো রুটে কপি করো
            for folder in {101..114}; do
              if [ -d "$temp_dir/$folder" ]; then
                echo "Moving surah $folder to root..."
                rsync -a "$temp_dir/$folder/" "./$folder/"
                rm -rf "$temp_dir/$folder"
              fi
            done

            # যদি কোনো কারণে ফোল্ডার না মিলে, তাহলে পুরোটা রুটে দিয়ে দাও
            if [ -n "$(ls -A "$temp_dir" 2>/dev/null)" ]; then
              echo "Copying remaining files to root..."
              rsync -a "$temp_dir"/ ./
            fi

            rm -rf "$temp_dir"
          done

          echo "Final structure in root:"
          ls -la | grep -E '^(101|102|103|104|105|106|107|108|109|110|111|112|113|114)' | head -10

      - name: Remove all zip files
        run: find . -name "*.zip" -delete

      - name: Commit & Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions@users.noreply.github.com"
          git add .
          git commit -m "Unzipped 101–114 surahs to repository root" || echo "Nothing to commit"
          git push || echo "Nothing to push"
