name: Download Audio ZIP and Push to Repo

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  download-and-push:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Repo checkout
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2️⃣ Download ZIP
    - name: Download ZIP from everyayah
      run: |
        mkdir temp
        curl -L "https://everyayah.com/data/Alafasy_64kbps/000_versebyverse.zip" -o temp/audio.zip

    # 3️⃣ Unzip
    - name: Unzip audio files
      run: |
        unzip temp/audio.zip -d extracted

    # 4️⃣ Copy to audio folder
    - name: Copy files to audio folder
      run: |
        rm -rf audio
        mkdir audio
        cp -r extracted/* audio/

    # 5️⃣ Git config
    - name: Setup Git
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

    # 6️⃣ Commit & Push
    - name: Commit and Push
      run: |
        git add .
        git commit -m "Add Alafasy verse-by-verse audio" || echo "Nothing to commit"
        git push
